<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
	<title>memory-impact</title>
	<script type="module">

		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
		import {
			getDatabase,
			set,
			ref,
			push,
			child,
			onValue,
			onChildAdded,
			update,
			get
		} from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";
		import {
			getAuth,
			createUserWithEmailAndPassword,
			signInWithEmailAndPassword,
			signOut
		} from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";



		// TODO: Add SDKs for Firebase products that you want to use
		// https://firebase.google.com/docs/web/setup#available-libraries

		// Your web app's Firebase configuration
		const firebaseConfig = {
			apiKey: "AIzaSyCSUQoYmYbmbkKoIbDQcQhOxnada13rBWY",
			authDomain: "memory-c1192.firebaseapp.com",
			projectId: "memory-c1192",
			storageBucket: "memory-c1192.appspot.com",
			messagingSenderId: "320978503728",
			appId: "1:320978503728:web:49c1ef1f72cd9a595745f5",
			measurementId: "G-QP4M89SW8F",
			databaseURL: "https://memory-c1192-default-rtdb.europe-west1.firebasedatabase.app/",
		};

		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const auth = getAuth();
		const database = getDatabase(app);
		var pseudoG;
		var verif = document.querySelector('.verif');
		var formulaire = document.querySelector('.formulaire');
		var messages = [];
		var submit = document.querySelector("#submit");
		var messagesList = document.getElementById('messages-list');
		var stop = 0;
		setInterval(() => {
			if (stop == 0) {
				var user2 = auth.currentUser;
				if (user2) {
					const li = document.createElement('h2');
					li.textContent = "Connecté";
					li.setAttribute("class", "truc");
					verif.appendChild(li);
					formulaire.style.display = 'none'
					formulaire.style.display = 'none'
					stop = 1;
				}
			}

		}, 10);
		submit.addEventListener('click', (e) => {
			var message = document.getElementById('message').value;
			var user = auth.currentUser;
			if (user) {

				var userId = user.uid;
				var userEmail = user.email;


				const id = push(child(ref(database), 'users/' + userId + '/messages')).key;
				set(ref(database, '/messages/' + id), {
					message: message,
					pseudo: pseudoG
				});


				//messages.push(message);
				document.getElementById('message').value = "";

				//alert('message has sent to ' + userEmail);

			} else {
				alert('You need to log in first');
			}
		});
		// Récupération de la référence à la base de données
		const messagesRef = ref(database, 'messages');
		const pseu = ref(database, 'users/');
		// Initialisation du tableau de messages
		//const messages = [];

		// Écoute des modifications sur le nœud "messages"
		onValue(messagesRef, (snapshot) => {
			messagesList = document.getElementById("messages-list");
			while (messagesList.firstChild) {
				messagesList.removeChild(messagesList.firstChild);
			}
			messages = [];

			// Parcours de tous les enfants de "messages"
			snapshot.forEach((childSnapshot) => {
				// Récupération des données du message
				const message = childSnapshot.val();
				// Ajout du message au tableau

				messages.push(message);
				//messages = messages.map(i => Number(i));
			});


			// Le tableau contient maintenant tous les messages stockés dans la base de données
			console.log(messages);


			//document.getElementById('messages-list').innerHTML = '';

			messages.sort((b, a) => b.message - a.message);

			//console.log(messages);
			messages.forEach((message) => {
				const li = document.createElement('li');
				const nom = document.createElement('span');
				const text = document.createElement('span');
				const br = document.createElement('br')
				nom.textContent = message.pseudo + ":";
				text.textContent = "Coups utilisé: " + message.message;

				li.appendChild(nom);
				li.appendChild(br);
				li.appendChild(text);

				messagesList.appendChild(li);

			});
		});
		setInterval(() => {

		},);
		submitData.addEventListener('click', (e) => {

			var email = document.getElementById('email').value;
			var password = document.getElementById('psw').value;
			var pseudo = document.getElementById('psd').value;
			if (pseudoG == undefined || pseudoG == null) {
				pseudoG = document.getElementById('psd').value;
			}

			//sign up user
			createUserWithEmailAndPassword(auth, email, password, pseudo)
				.then((userCredential) => {
					// Signed in
					const user = userCredential.user;
					// ... user.uid
					set(ref(database, 'users/' + user.uid), {
						email: email,
						password: password,
						pseudo: pseudo
					})
						.then(() => {
							// Data saved successfully!
							alert('user created successfully');


						})
						.catch((error) => {
							// The write failed...
							alert(error);
						});
				})
				.catch((error) => {
					const errorCode = error.code;
					const errorMessage = error.message;
					// ..
					alert(errorMessage);
				});
			const usersRef = ref(database, 'users');
			const dbRef = ref(getDatabase());
			var pseudoL = [];
			get(child(dbRef, `users/`)).then((snapshot) => {
				if (snapshot.exists()) {
					snapshot.forEach((childSnapshot) => {
						// Récupération des données du message
						var ps = childSnapshot.val();
						// Ajout du message au tableau
						if (ps.email === email) {
							pseudoG = ps.pseudo;
							console.log("c'est son speudo", pseudoG)

						}

						pseudoL.push(ps);
						//messages = messages.map(i => Number(i));
					});

					console.log(pseudoL[1].pseudo);
				} else {
					console.log("No data available");
				}
			}).catch((error) => {
				console.error(error);
			});

		});
		document.querySelector("#deco").addEventListener('click', (e) => {
			//sign out user
			signOut(auth).then(() => {
				// Sign-out successful.
				formulaire.style.display = 'unset'
				var connect = document.querySelector(".truc")
				connect.remove();
			}).catch((error) => {
				// An error happened.
			});
		})

		document.querySelector("#franchement").addEventListener('click', (e) => {

			var email = document.getElementById('email').value;
			var password = document.getElementById('psw').value;
			var pseudo = document.getElementById('psd').value;
			if (pseudoG == undefined || pseudoG == null) {
				pseudoG = document.getElementById('psd').value;
			}


			// log in user
			signInWithEmailAndPassword(auth, email, password, pseudo)
				.then((userCredential) => {
					// Signed in
					const user = userCredential.user;
					// ...

					// save log in details into real time database
					var lgDate = new Date();
					update(ref(database, 'users/' + user.uid), {
						last_login: lgDate,
					})
						.then(() => {
							// Data saved successfully!
							alert('user logged in successfully');


						})
						.catch((error) => {
							// The write failed...
							alert(error);
						});
				})
				.catch((error) => {
					const errorCode = error.code;
					const errorMessage = error.message;
					alert(errorMessage);
				});
			const usersRef = ref(database, 'users');
			const dbRef = ref(getDatabase());
			var pseudoL = [];
			get(child(dbRef, `users/`)).then((snapshot) => {
				if (snapshot.exists()) {
					snapshot.forEach((childSnapshot) => {
						// Récupération des données du message
						var ps = childSnapshot.val();
						// Ajout du message au tableau
						if (ps.email === email) {
							pseudoG = ps.pseudo;
							console.log("c'est son speudo", pseudoG)

						}

						pseudoL.push(ps);
						//messages = messages.map(i => Number(i));
					});

					console.log(pseudoL[1].pseudo);
				} else {
					console.log("No data available");
				}
			}).catch((error) => {
				console.error(error);
			});
		});


	</script>
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="trueStyle.css">
	<style>
		.formulaire {
			position: relative;
			z-index: 999;
		}
	</style>
</head>

<body>
	<div class="verif">
		<button type="button" id="deco" name="deco" class="registerbtn">Déconnection</button>
	</div>
	<form class="formulaire">
		<div class="container">
			<h1>Register</h1>
			<p>Please fill in this form to create an account.</p>
			<hr>

			<label for="email"><b>Email</b></label>
			<input type="text" placeholder="Enter Email" id="email" required>

			<label><b>Password</b></label>
			<input type="password" placeholder="Password" id="psw" required>

			<label for="pseudo"><b>Pseudo</b></label>
			<input type="text" placeholder="Entre un Pseudo" id="psd" required>


			<hr>
			<p>By creating an account you agree to our <a href="#">Terms & Privacy</a>.</p>

			<button type="button" id="submitData" name="submitData" class="registerbtn">Inscription</button>
			<button type="button" id="franchement" name="franchement" class="registerbtn">Connexion</button>
			<button type="button" id="deco" name="deco" class="registerbtn">Déconnection</button>
			<textarea id="message" class="form-control type_msg" placeholder="Type your message..."></textarea>
			<button id="submit" class="input-group-text send_btn"><i class="fas fa-location-arrow"></i>
			</button>
		</div>

		<div class="container signin">
			<p>Already have an account? <a href="#">Sign in</a>.</p>
		</div>
	</form>

	<header class="site-header container animated fadeInDown">

		<div class="header-wrapper">
			<div class="row">
				<div class="col-md-4">
					<div class="site-branding">
						<a href="#">
							<h1 class="chika">ChikaCorp</h1>
						</a>
					</div>
				</div>
				<a href="#" class="toggle-nav hidden-md hidden-lg">
					<i class="fa fa-bars"></i>
				</a>
				<div class="col-md-8">
					<nav id="nav" class="main-navigation hidden-xs hidden-sm">
						<ul class="main-menu">
							<li><a class="show-1 active homebutton" href="#">Home</a></li>


						</ul>
					</nav>
					<nav class="main-navigation menu-responsive hidden-md hidden-lg">
						<ul class="main-menu">
							<li><a class="show-1 active homebutton" href="#">Home</a></li>


						</ul>
					</nav>
				</div>
			</div>
		</div>
	</header>


	<div id="menu-container">
		<div id="menu-1" class="homepage home-section container">
			<div class="home-intro text-center">
				<h2 class="welcome-title animated fadeInLeft">Présentation</h2>
				<p class="animated fadeInRight">Vous êtes prêt à mettre à l'épreuve votre mémoire ? Bienvenue sur notre
					projet de jeu memory ! Avec des cartes époustouflants venant tout droit de Genshin Impact,
					et des modes de jeu exclusifs, ce jeu est l'expérience de mémoire ultime. Que vous soyez un
					aventurier débutant ou un expert en quête d'un défi supplémentaire, il y a un niveau de difficulté
					qui convient à tous les joueurs. Alors, préparez-vous à explorer les méandres de votre esprit tout
					en vous amusant ! Nous espérons que vous apprécierez notre version unique et originale du jeu !</p>
			</div>
			<div class="home-projects">
				<div class="row">
					<div class="col-md-6 col-sm-12">
						<div class="project-title animated fadeInUp">
							<h2>Tableau des scores</h2>
							<ol id="messages-list">
							</ol>
						</div>
					</div>
					<div class="project-home-holder col-md-6 col-sm-12">
						<div class="row">
							<div class="col-md-6 col-sm-6">
								<div class="button-64 animated fadeInRight">

									<a href="https://chikage04.github.io/memory-impact/indexEZ.html" class="vasy">
										<span class="text">Mode Normal</span>
									</a>

								</div>
							</div>
							<div class="col-md-6 col-sm-6">
								<div class="button-64 animated fadeInRight">
									<a href="https://chikage04.github.io/memory-impact/indexBIS.html" class="vasy">
										<span class="text">Mode Hard</span>
									</a>
								</div>
							</div>
							<div class="col-md-6 col-sm-6">
								<div class="button-64 animated fadeInRight">


									<a href="https://chikage04.github.io/memory-impact/indexDark.html" class="vasy">
										<span class="text">Mode Blind</span>
									</a>

								</div>
							</div>
							<div class="col-md-6 col-sm-6">
								<div class="button-64 animated fadeInRight">
									<a href="https://chikage04.github.io/memory-impact/indexSpeed.html" class="vasy">
										<span class="text">Contre-la-<br>montre</span>
									</a>
								</div>
							</div>
							<div class="col-md-6 col-sm-6" id="millieu">
								<div class="button-64 animated fadeInRight">
									<a href="https://chikage04.github.io/memory-impact/hellspeed.html" class="vasy">
										<span class="text">Contre-la-<br>montre:<br>HELL</span>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="menu-2" class="content about-section container">
		<div class="our-story">
			<div class="story-bg animated fadeIn"></div>
			<div class="row">
				<div class="col-md-6 col-md-offset-3">
					<div class="inner-story animated fadeInRight text-center">
						<h2>ABOUT US</h2>
						<p>Cras placerat, est ac sollicitudin laoreet, ante enim egestas lorem, vel auctor nibh
							massa sit amet lacus. Cras mollis tellus id sollicitudin vulputate. Vestibulum ante
							ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Nullam gravida
							arcu</p>
					</div>
				</div>
			</div>
		</div>
		<div class="our-offers">
			<div class="offer-bg animated fadeIn"></div>
			<div class="offer-header">
				<div class="row">
					<div class="col-md-6 col-md-offset-3 text-center">
						<div class="offer-title animated fadeInDown">
							<h2>OUR WORK</h2>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="offer-holder">
					<div class="col-md-6">
						<div class="offer-item offer-1 animated fadeInLeft">
							<figure>
								<img src="img/a1.jpg" alt="">
							</figure>
							<div class="offer-content text-center">
								<h4>HAPPY WORKING WITH US</h4>
								<p>Sed sagittis nunc vel tellus ultricies auctor. Class aptent taciti sociosqu ad
									litora torquent per conubia , per inceptos himenaeos. Integer eleifend tellu.
								</p>
								<span class="offer-left"><i></i></span>
								<span class="offer-right"><i></i></span>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="offer-item offer-2 animated fadeInRight">
							<figure>
								<img src="img/a2.jpg" alt="">
							</figure>
							<div class="offer-content text-center">
								<h4>OUR COMPANY BACKGROUND</h4>
								<p>Sed sagittis nunc vel tellus ultricies auctor. Class aptent taciti sociosqu ad
									litora torquent per conubia , per inceptos himenaeos. Integer eleifend tellu.
								</p>
								<span class="offer-left"><i></i></span>
								<span class="offer-right"><i></i></span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	</div>


	<footer class="site-footer container text-center">
		<div class="row">
			<div class="col-md-12">
				<div class="main-footer">
					<ul class="social">
						<li><a>Discord: Chikage#4907</a></li>
						<li><button type="button" onclick="jsp()">Récupérer la valeur</button></li>
						<li><input id="in" type="text"></li>
						<li><input id="iné" type="text"></li>
					</ul>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 copyright">
				<p>Copyright &copy; 2023 <a href="#">Chikage Corporation</a></p>
			</div>
		</div>
	</footer>

	<script src="js/jquery.min.js"></script>
	<script src="js/templatemo_custom.js"></script>
</body>

</html>